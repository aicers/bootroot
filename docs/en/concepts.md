# Concepts

This section gives you enough background to understand what you are operating.

## PKI and Certificates

- A **Certificate Authority (CA)** signs certificates that bind a public key
  to an identity (a hostname or IP address).
- A **certificate** contains identity fields (Subject, SANs), validity, and
  the CA signature.
- A **private key** must be protected. It proves possession of the identity.

## CSR (Certificate Signing Request)

A **CSR** is generated by the client. It contains the public key and requested
identities (SANs). The CA verifies the request and issues a certificate.

## ACME

ACME (RFC 8555) is the automated issuance protocol used by step-ca. An ACME
account is a registration at the CA that includes an account key and contact
email. bootroot-agent creates and registers this account automatically on its
first connection.

Key terms in the ACME flow:

- **Account**: a registered identity at the CA, tied to an account key and
  contact info. All orders are signed by this account.
- **Order**: a request to issue a certificate for a set of identifiers (SANs).
- **Authorization**: proof of control for a specific identifier.
- **Challenge**: the validation method for an authorization (HTTP-01 here).
- **Finalize**: submits the CSR once all authorizations are valid.
- **Certificate**: the issued certificate downloaded from the CA.

## HTTP-01 Challenge

HTTP-01 is a domain control check. The CA gives the client a **token**, and
then makes an HTTP request to verify that the domain owner can serve it.

Flow:

1. step-ca returns an HTTP-01 token to bootroot-agent as part of the
   authorization response.
2. bootroot-agent receives that token and registers it with the **HTTP-01
   responder** admin API (port 8080).
3. step-ca sends an HTTP request to the **HTTP-01 responder** at
   `http://<domain>/.well-known/acme-challenge/<token>` on port 80.
4. The **HTTP-01 responder** returns the correct key authorization, and the
   CA marks the **domain control authorization** as valid.

## EAB (External Account Binding)

EAB allows a CA to restrict registrations. The operator supplies a key ID
and HMAC key. bootroot-agent can load EAB from config or CLI.

## Secret Manager (OpenBao)

In production, avoid hardcoding secrets in files or environment variables.
Use a secret manager like OpenBao, which provides Vault-compatible KV v2
storage. Store and inject:

- step-ca password (`password.txt`)
- step-ca DB DSN
- HTTP-01 responder HMAC
- EAB `kid`/`hmac`

OpenBao is initialized with **unseal keys** and a **root token**. Services
should authenticate with AppRole and read only the required paths.

## SAN (Subject Alternative Name)

SANs are the identities inside the certificate. Common types:

- **DNS**: `example.internal`
- **IP**: `192.0.2.10`

## mTLS

Mutual TLS requires both client and server to present certificates.
If you control issuance and renewal, you can automate mTLS safely.
