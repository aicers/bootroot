# Bootroot Agent Configuration Example (Multi-Profile)
# Rename this file to agent.toml to use it.

# Support email address for ACME registration
email = "admin@example.com"

# ACME Directory URL
# Default: https://localhost:9000/acme/acme/directory (Step CA)
server = "https://localhost:9000/acme/acme/directory"

# SPIFFE trust domain used for URI SANs
spiffe_trust_domain = "trusted.domain"

# Scheduler settings
[scheduler]
max_concurrent_issuances = 3

# ACME behavior settings
[acme]
# HTTP-01 challenge listen port
http_challenge_port = 80
# Directory fetch retries and backoff (seconds)
directory_fetch_attempts = 10
directory_fetch_base_delay_secs = 1
directory_fetch_max_delay_secs = 10
# Order polling behavior
poll_attempts = 15
poll_interval_secs = 2

# Retry settings for issuance attempts
[retry]
backoff_secs = [5, 10, 30]

# Optional global External Account Binding (EAB) Credentials
# [eab]
# kid = "your-key-id"
# hmac = "your-hmac-key"

# Profiles (one per daemon instance)
[[profiles]]
name = "edge-proxy-a"
daemon_name = "edge-proxy"
instance_id = "001"
hostname = "edge-node-01"
uri_san_enabled = true
domains = ["edge-proxy.internal"]

[profiles.paths]
# Path to save the certificate
cert = "certs/edge-proxy-a.pem"
# Path to save the private key
key = "certs/edge-proxy-a.key"

# Daemon mode settings (auto-renewal)
[profiles.daemon]
# How often to check certificate validity
check_interval = "1h"
# Start renewal 30 days (720h) before expiry
renew_before = "720h"
# Randomize check interval by +/- jitter (0s disables)
check_jitter = "0s"

[profiles.retry]
# Optional per-profile retry backoff override
backoff_secs = [5, 10, 30]

# Post-renewal hooks
[profiles.hooks.post_renew]
# Commands to run after a successful renewal
# success = [
#   {
#     command = "nginx"
#     args = ["-s", "reload"]
#     working_dir = "/etc/nginx"
#     timeout_secs = 30
#     retry_backoff_secs = [5, 10, 30]
#     max_output_bytes = 4096
#     on_failure = "continue"
#   }
# ]
# Commands to run after a failed renewal
# failure = [
#   {
#     command = "logger"
#     args = ["bootroot renewal failed"]
#     timeout_secs = 30
#     on_failure = "stop"
#   }
# ]

# Optional per-profile EAB override
# [profiles.eab]
# kid = "your-key-id"
# hmac = "your-hmac-key"
